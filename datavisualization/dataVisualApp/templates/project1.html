{% load static %}
<!-- data_analysis/templates/eda.html -->
<!DOCTYPE html>

<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dengue Cases</title>
    <link rel="stylesheet" type="text/css" href="{% static 'image/base.css' %}">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css">
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.12.0/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css"
        href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css">
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <header class="header">

    </header>

    <div class="sidebar">
        <div class="logo-details">
            <i class='bx bxs-dice-3 icon'></i>
            <div class="logo_name">Group 3</div>
            <i class='bx bx-menu' id="btn"></i>
        </div>

        <ul class="nav-list">
            <li>
                <a href="{% url 'project1' %}">
                    <i class='bx bx-plus-medical'></i>
                    <span class="links_name">Dengue Case</span>
                </a>
                <span class="tooltip">Dengue Case</span>
            </li>

            <li>
                <a href="{% url 'project2' %}">
                    <i class='bx bx-wind'></i>
                    <span class="links_name">Air Quality</span>
                </a>
                <span class="tooltip">Air Quality</span>
            </li>

            <li>
                <a href="{% url 'project3' %}">
                    <i class='bx bx-chat'></i>
                    <span class="links_name">Rawr</span>
                </a>
                <span class="tooltip">Rawr</span>
            </li>
            <li>
                <a href="{% url 'others' %}">
                    <i class='bx bx-upload'></i>
                    <span class="links_name">Upload</span>
                </a>
                <span class="tooltip">Upload</span>
            </li>

            <!-- ... your other HTML code ... -->
            <li class="profile">
                <div class="profile-details">
                    <i class='bx bxs-user-circle'></i>

                    <div class="name">{{ user.email }}</div>


                </div>
                <button type="button" onclick="location.href='{% url 'logout' %}'">
                    <i class='bx bx-log-out' id="log_out"></i>Logout
                </button>
            </li>
            <!-- ... your other HTML code ... -->

        </ul>
    </div>
    </div>

    <main class="main">
        <div class="card">
            <div class="Dengue">
                <span>Dengue Cases from 2016 to 2021 in the Philippines</span>
                <p>Source: The Humanitarian Data Exchange</p>
            </div>
        </div>

        <div class="card">
            <div class="narration">
                <p>Percentage of Cases by Region</p>

            </div>
            <button id="Button-38" class="button-38">View Regions</button>
            <canvas id="pieChart" width="50" height="50"></canvas>
            <button id="arrow" onclick="scrollToMain2()">
                <div class="butt"><i class='bx bxs-down-arrow'></i></div>
            </button>
        </div>
        <div class="card">
            <div class="narration">
                <p>The number of deaths per year, starting from 2016 up to 2021</p>
            </div>
            <canvas id="barChart" width="100" height="50"></canvas>
        </div>
        </div>


    </main>

    <main id="main2" class="2main">
        <div class="card">
            <div class="narration">
                <p>The number of cases per year, starting from 2016 up to 2021</p>
            </div>
            <canvas id="lineChart" width="100" height="60"></canvas>
            <div class="narration">
                <p>The number of cases in the Philippines increased steadily from 2016 to 2020, with a significant spike in 2020. The increase can be attributed to a number of factors, including an aging population, non-communicable diseases, and the COVID-19 pandemic.</p>
            </div>
        </div>

        <div class="card">
            <button class="button-17" role="button"><a href="{{ dataset_link }}">Download</a></button>
           <div id="data-container"></div>
        </div>
        <div id="data-container"></div>
        <!-- Corrected table structure -->


        <!--- <div class="card">
                <a href="{{ dataset_link }}">Download</a>
            </div>-->
        </div>


    </main>
</body>

</html>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.datatables.net/1.12.0/js/jquery.dataTables.min.js"></script>

<script>
    $(document).ready(function () {
        // Display the data in a table
        var tableHtml = '<table id="data-table" border="1">';
        tableHtml += '<thead><tr>';

        // Add column headers
        for (var colName of {{ data_head_json.columns|safe }}) {
            tableHtml += '<th>' + colName + '</th>';
        }

        tableHtml += '</tr></thead>';
        tableHtml += '<tbody>';

        // Add rows and data
        for (var row of {{ data_head_json.data|safe }}) {
            tableHtml += '<tr>';
            for (var cell of row) {
                tableHtml += '<td>' + cell + '</td>';
            }
            tableHtml += '</tr>';
        }

        tableHtml += '</tbody></table>';

        // Append the table to the data-container div
        $('#data-container').html(tableHtml);

        // Initialize DataTables
        $('#data-table').DataTable({
            "aLengthMenu": [[10, 25, 50-1], [10, 25, 50, "All"]],
            "iDisplayLength": 10
        });
    });
</script>

<script>

    // Get the data from the Django context
    var regionLabels = {{ region_labels| safe }};
    var regionData = {{ region_data| safe }};
    var yearLabels = {{ year_labels| safe }};
    var casesData = {{ cases_data| safe }};
    var deathsData = {{ deaths_data| safe }};

    // Create a pie chart using Chart.js
    var pieCtx = document.getElementById('pieChart').getContext('2d');
    var pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
            labels: regionLabels,
            datasets: [{
                data: regionData,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(125, 200, 86, 0.8)',
                    'rgba(215, 206, 86, 0.8)',
                    'rgba(75, 192, 192, 0.8)',
                    'rgba(255, 159, 64, 0.8)',
                    'rgba(105, 105, 105, 0.8)',
                    'rgba(176, 224, 230, 0.8)',
                    'rgba(255, 182, 193, 0.8)',
                    'rgba(0, 128, 128, 0.8)',
                    'rgba(255, 69, 0, 0.8)',
                    'rgba(0, 0, 139, 0.8)',
                    'rgba(255, 165, 0, 0.8)',
                    'rgba(0, 255, 0, 0.8)',
                    'rgba(139, 0, 139, 0.8)',
                    'rgba(0, 255, 255, 0.8)',
                    'rgba(255, 255, 0, 0.8)',

                    // Add more colors as needed
                ],
            }],
        },

    });

    // Toggle the legend's visibility when the button is clicked
    $('#Button-38').on('click', function () {
        var pieLegend = pieChart.options.plugins.legend;
        pieLegend.display = !pieLegend.display;
        pieChart.update();
    });

    var lineCtx = document.getElementById('lineChart').getContext('2d');
    var lineChart = new Chart(lineCtx, {
        type: 'line',
        data: {
            labels: yearLabels,
            datasets: [{
                label: 'Number of Cases Per Year',
                data: casesData,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(125, 200, 86, 0.8)',
                    'rgba(215, 206, 86, 0.8)',
                    // Add more colors as needed
                ],
            }],
        },
    });

    var barCtx = document.getElementById('barChart').getContext('2d');
    var barChart = new Chart(barCtx, {
        type: 'bar',
        data: {
            labels: yearLabels,
            datasets: [{
                label:'Number of Deaths Per Year',
                data: deathsData,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.8)',
                    'rgba(54, 162, 235, 0.8)',
                    'rgba(255, 206, 86, 0.8)',
                    'rgba(125, 200, 86, 0.8)',
                    'rgba(215, 206, 86, 0.8)',
                    // Add more colors as needed
                ],
            }],
        },
        options: {
            legend: {
                display: false
            }
        }
    });


    function scrollToMain2() {
        var main2Element = document.getElementById('main2');
        main2Element.scrollIntoView({ behavior: 'smooth' });
    }

    let sidebar = document.querySelector(".sidebar");
    let closeBtn = document.querySelector("#btn");

    closeBtn.addEventListener("click", () => {
        sidebar.classList.toggle("open");
        menuBtnChange();//calling the function(optional)
    });
    searchBtn.addEventListener("click", () => { // Sidebar open when you click on the search iocn
        sidebar.classList.toggle("open");
        menuBtnChange(); //calling the function(optional)
    });
    // following are the code to change sidebar button(optional)
    function menuBtnChange() {
        if (sidebar.classList.contains("open")) {
            closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");//replacing the iocns class
        } else {
            closeBtn.classList.replace("bx-menu-alt-right", "bx-menu");//replacing the iocns class
        }
    }


</script>
<script>
    $(document).ready(function () {
        $('#bootstrapdatatable').DataTable({
            "aLengthMenu": [[3, 5, 10, 25, -1], [3, 5, 10, 25, "All"]],
            "iDisplayLength": 3
        }
        );
    });